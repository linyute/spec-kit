---
description: 根據使用者需求為當前功能產生自訂檢查表。
scripts:
  sh: scripts/bash/check-prerequisites.sh --json
  ps: scripts/powershell/check-prerequisites.ps1 -Json
---

## 檢查表目的：「英文的單元測試」

**關鍵概念**：檢查表是**需求撰寫的單元測試**——它們驗證給定領域中需求的品質、清晰度和完整性。

**不適用於驗證/測試**：

- ❌ 不用於「驗證按鈕是否正確點擊」
- ❌ 不用於「測試錯誤處理是否有效」
- ❌ 不用於「確認 API 返回 200」
- ❌ 不用於檢查程式碼/實作是否與規格匹配

**用於需求品質驗證**：

- ✅ 「是否為所有卡片類型定義了視覺層次結構需求？」（完整性）
- ✅ 「『顯著顯示』是否用具體的大小/定位進行量化？」（清晰度）
- ✅ 「所有互動元素上的懸停狀態需求是否一致？」（一致性）
- ✅ 「是否為鍵盤導航定義了輔助功能需求？」（覆蓋率）
- ✅ 「規格是否定義了當標誌圖片載入失敗時會發生什麼？」（邊緣案例）

**比喻**：如果您的規格是用英文編寫的程式碼，那麼檢查表就是它的單元測試套件。您正在測試需求是否撰寫良好、完整、明確且準備好實作——而不是實作是否有效。

## 使用者輸入

```text
$ARGUMENTS
```

您**必須**在繼續之前考慮使用者輸入（如果非空）。

## 執行步驟

1. **設定**：從倉庫根目錄執行 `{SCRIPT}` 並解析 FEATURE_DIR 和 AVAILABLE_DOCS 列表的 JSON。
   - 所有檔案路徑都必須是絕對路徑。
   - 對於像 "I'm Groot" 這樣的參數中的單引號，請使用轉義語法：例如 'I'\''m Groot'（如果可能，也可以使用雙引號："I'm Groot"）。

2. **澄清意圖（動態）**：推導最多三個初始上下文澄清問題（沒有預先建立的目錄）。它們**必須**：
   - 從使用者的措辭 + 從規格/計畫/任務中提取的訊號產生
   - 僅詢問實質性改變檢查表內容的資訊
   - 如果在 `$ARGUMENTS` 中已經明確，則單獨跳過
   - 優先考慮精確度而非廣度

   產生演算法：
   1. 提取訊號：功能領域關鍵字（例如，auth、latency、UX、API）、風險指標（「critical」、「must」、「compliance」）、利害關係人提示（「QA」、「review」、「security team」）和明確的交付物（「a11y」、「rollback」、「contracts」）。
   2. 將訊號聚類到候選焦點區域（最多 4 個），按相關性排名。
   3. 如果不明確，則識別可能的受眾和時間（作者、審閱者、QA、發布）。
   4. 偵測缺失的維度：範圍廣度、深度/嚴謹性、風險強調、排除邊界、可衡量的驗收標準。
   5. 從這些原型中制定問題：
      - 範圍細化（例如，「這是否應包括與 X 和 Y 的整合接觸點，還是僅限於本地模組的正確性？」）
      - 風險優先級排序（例如，「這些潛在風險區域中哪些應接受強制性門控檢查？」）
      - 深度校準（例如，「這是一個輕量級的預提交健全性列表還是正式的發布門？」）
      - 受眾框架（例如，「這將僅由作者使用還是由同行在 PR 審查期間使用？」）
      - 邊界排除（例如，「我們是否應明確排除本輪的效能調整項目？」）
      - 情境類別差距（例如，「未偵測到恢復流程——回滾/部分故障路徑是否在範圍內？」）

   問題格式規則：
   - 如果呈現選項，則產生一個緊湊的表格，包含以下欄位：選項 | 候選 | 為何重要
   - 最多限制為 A-E 選項；如果自由形式答案更清晰，則省略表格
   - 永遠不要要求使用者重述他們已經說過的內容
   - 避免推測性類別（不虛構）。如果不確定，請明確詢問：「確認 X 是否屬於範圍內。」

   互動不可能時的預設值：
   - 深度：標準
   - 受眾：如果與程式碼相關，則為審閱者 (PR)；否則為作者
   - 焦點：前 2 個相關性聚類

   輸出問題（標記 Q1/Q2/Q3）。回答後：如果 ≥2 個情境類別（替代/例外/恢復/非功能領域）仍不明確，您**可以**再詢問最多兩個有針對性的後續問題（Q4/Q5），每個問題附帶一行理由（例如，「未解決的恢復路徑風險」）。總問題數不要超過五個。如果使用者明確拒絕更多問題，則跳過升級。

3. **了解使用者請求**：結合 `$ARGUMENTS` + 澄清答案：
   - 推導檢查表主題（例如，安全性、審查、部署、使用者體驗）
   - 整合使用者提及的明確必備項目
   - 將焦點選擇映射到類別支架
   - 從規格/計畫/任務中推斷任何缺失的上下文（**不**虛構）

4. **載入功能上下文**：從 FEATURE_DIR 讀取：
   - spec.md：功能需求和範圍
   - plan.md（如果存在）：技術細節、依賴關係
   - tasks.md（如果存在）：實作任務

   **上下文載入策略**：
   - 僅載入與活動焦點區域相關的必要部分（避免完整檔案轉儲）
   - 優先將長部分總結為簡潔的情境/需求項目
   - 使用漸進式揭露：僅在偵測到差距時才添加後續檢索
   - 如果來源文件很大，則產生臨時摘要項目而不是嵌入原始文字

5. **產生檢查表**——建立「需求的單元測試」：
   - 如果 `FEATURE_DIR/checklists/` 目錄不存在，則建立它
   - 產生唯一的檢查表檔案名稱：
     - 根據領域使用簡短、描述性的名稱（例如，`ux.md`、`api.md`、`security.md`）
     - 格式：`[domain].md`
     - 如果檔案存在，則附加到現有檔案
   - 從 CHK001 開始按順序編號項目
   - 每次執行 `/speckit.checklist` 都會建立一個**新**檔案（永遠不會覆蓋現有的檢查表）

   **核心原則——測試需求，而不是實作**：
   每個檢查表項目**必須**評估**需求本身**的：
   - **完整性**：所有必要的需求是否存在？
   - **清晰度**：需求是否明確且具體？
   - **一致性**：需求之間是否一致？
   - **可衡量性**：需求是否可以客觀驗證？
   - **覆蓋率**：所有情境/邊緣案例是否都已處理？

   **類別結構**——按需求品質維度分組項目：
   - **需求完整性**（所有必要的需求是否已記錄？）
   - **需求清晰度**（需求是否具體且明確？）
   - **需求一致性**（需求之間是否一致且沒有衝突？）
   - **驗收標準品質**（成功標準是否可衡量？）
   - **情境覆蓋率**（所有流程/案例是否都已處理？）
   - **邊緣案例覆蓋率**（是否定義了邊界條件？）
   - **非功能需求**（效能、安全性、輔助功能等——是否已指定？）
   - **依賴關係和假設**（是否已記錄和驗證？）
   - **模糊和衝突**（需要澄清什麼？）

   **如何撰寫檢查表項目——「英文的單元測試」**：

   ❌ **錯誤**（測試實作）：
   - 「驗證登陸頁面顯示 3 個劇集卡片」
   - 「測試懸停狀態在桌面上是否有效」
   - 「確認標誌點擊導航到主頁」

   ✅ **正確** (測試需求品質):
   - "是否指定了特色劇集的確切數量和佈局？" [完整性]
   - "是否以具體尺寸/定位量化了「突出顯示」？" [清晰度]
   - "所有互動元素上的懸停狀態要求是否一致？" [一致性]
   - "是否為所有互動式使用者介面定義了鍵盤導航要求？" [覆蓋率]
   - "當標誌圖片載入失敗時，是否指定了備用行為？" [邊緣案例]
   - "是否為非同步劇集資料定義了載入狀態？" [完整性]
   - "規格是否定義了競爭性使用者介面元素的視覺層次結構？" [清晰度]

   **項目結構**：
   每個項目都應遵循此模式：
   - 詢問需求品質的問題格式
   - 專注於規格/計畫中**撰寫的內容**（或未撰寫的內容）
   - 在方括號中包含品質維度 [完整性/清晰度/一致性/等]
   - 檢查現有需求時參考規格部分 `[Spec §X.Y]`
   - 檢查缺失需求時使用 `[Gap]` 標記

   **按品質維度劃分的範例**：

   完整性：
   - 「是否為所有 API 故障模式定義了錯誤處理需求？[Gap]」
   - 「是否為所有互動元素指定了輔助功能需求？[完整性]」
   - 「是否為響應式佈局定義了行動斷點需求？[Gap]」

   清晰度：
   - 「『快速載入』是否用具體的時間閾值量化？[清晰度，規格 §NFR-2]」
   - 「是否明確定義了『相關劇集』選擇標準？[清晰度，規格 §FR-5]」
   - 「『顯著』是否用可衡量的視覺屬性定義？[模糊，規格 §FR-4]」

   一致性：
   - 「導航需求是否在所有頁面之間保持一致？[一致性，規格 §FR-10]」
   - 「登陸頁面和詳細資訊頁面之間的卡片元件需求是否一致？[一致性]」

   覆蓋率：
   - 「是否為零狀態情境（無劇集）定義了需求？[覆蓋率，邊緣案例]」
   - 「是否處理了並發使用者互動情境？[覆蓋率，Gap]」
   - 「是否指定了部分資料載入失敗的需求？[覆蓋率，例外流程]」

   可衡量性：
   - 「視覺層次結構需求是否可衡量/可測試？[驗收標準，規格 §FR-1]」
   - 「『平衡視覺權重』是否可以客觀驗證？[可衡量性，規格 §FR-2]」

   **情境分類和覆蓋率**（需求品質焦點）：
   - 檢查是否存在以下情境的需求：主要、替代、例外/錯誤、恢復、非功能情境
   - 對於每個情境類別，詢問：「[情境類型] 需求是否完整、清晰且一致？」
   - 如果情境類別缺失：「[情境類型] 需求是否被有意排除或缺失？[Gap]」
   - 當發生狀態變異時，包括彈性/回滾：「是否為遷移失敗定義了回滾需求？[Gap]」

   **可追溯性需求**：
   - 最低：≥80% 的項目**必須**包含至少一個可追溯性參考
   - 每個項目都應參考：規格部分 `[Spec §X.Y]`，或使用標記：`[Gap]`、`[Ambiguity]`、`[Conflict]`、`[Assumption]`
   - 如果沒有 ID 系統：「是否建立了需求和驗收標準 ID 方案？[可追溯性]」

   **發現和解決問題**（需求品質問題）：
   詢問有關需求本身的問題：
   - 模糊： 「『快速』一詞是否用具體指標量化？[模糊，規格 §NFR-1]」
   - 衝突： 「導航需求在 §FR-10 和 §FR-10a 之間是否衝突？[衝突]」
   - 假設： 「『始終可用的播客 API』的假設是否已驗證？[假設]」
   - 依賴關係： 「是否記錄了外部播客 API 需求？[依賴關係，Gap]」
   - 缺失定義： 「『視覺層次結構』是否用可衡量標準定義？[Gap]」

   **內容整合**：
   - 軟上限：如果原始候選項目 > 40，則按風險/影響優先排序
   - 合併檢查相同需求方面的近乎重複項
   - 如果 >5 個低影響邊緣案例，則建立一個項目：「邊緣案例 X、Y、Z 是否在需求中得到處理？[覆蓋率]」

   **🚫 絕對禁止**——這些使其成為實作測試，而不是需求測試：
   - ❌ 任何以「驗證」、「測試」、「確認」、「檢查」+ 實作行為開頭的項目
   - ❌ 參考程式碼執行、使用者動作、系統行為
   - ❌ 「正確顯示」、「正常工作」、「按預期功能」
   - ❌ 「點擊」、「導航」、「渲染」、「載入」、「執行」
   - ❌ 測試案例、測試計畫、QA 程序
   - ❌ 實作細節（框架、API、演算法）

   ✅ **所需模式**——這些測試需求品質：
   - ✅ 「是否為 [情境] 定義/指定/記錄了 [需求類型]？」
   - ✅ 「[模糊術語] 是否用具體標準量化/澄清？」
   - ✅ 「[部分 A] 和 [部分 B] 之間的需求是否一致？」
   - ✅ 「[需求] 是否可以客觀衡量/驗證？」
   - ✅ 「[邊緣案例/情境] 是否在需求中得到處理？」
   - ✅ 「規格是否定義了 [缺失方面]？」

6. **結構參考**：按照 `templates/checklist-template.md` 中的規範範本產生檢查表，用於標題、元部分、類別標題和 ID 格式。如果範本不可用，則使用：H1 標題、目的/建立元行、包含 `- [ ] CHK### <需求項目>` 行的 `##` 類別部分，其中 ID 從 CHK001 開始全局遞增。

7. **報告**：輸出建立的檢查表的完整路徑、項目計數，並提醒使用者每次執行都會建立一個新檔案。總結：
   - 選定的焦點區域
   - 深度級別
   - 參與者/時間
   - 任何使用者指定的必備項目

**重要**：每次 `/speckit.checklist` 命令調用都會使用簡短、描述性的名稱建立一個檢查表檔案，除非檔案已存在。這允許：

- 多種類型的檢查表（例如，`ux.md`、`test.md`、`security.md`）
- 簡單、易記的檔案名稱，指示檢查表目的
- 在 `checklists/` 資料夾中輕鬆識別和導航

為避免混亂，請使用描述性類型並在完成後清理過時的檢查表。

## 檢查表類型範例和項目範例

**使用者體驗需求品質**：`ux.md`

項目範例（測試需求，**不**測試實作）：

- 「視覺層次結構需求是否用可衡量標準定義？[清晰度，規格 §FR-1]」
- 「是否明確指定了使用者介面元素的數量和定位？[完整性，規格 §FR-1]」
- 「互動狀態需求（懸停、焦點、活動）是否一致定義？[一致性]」
- 「是否為所有互動元素指定了輔助功能需求？[覆蓋率，Gap]」
- 「當圖片載入失敗時是否定義了備用行為？[邊緣案例，Gap]」
- 「『顯著顯示』是否可以客觀衡量？[可衡量性，規格 §FR-4]」

**API 需求品質**：`api.md`

項目範例：

- 「是否為所有故障情境指定了錯誤回應格式？[完整性]」
- 「速率限制需求是否用具體閾值量化？[清晰度]」
- 「所有端點的身份驗證需求是否一致？[一致性]」
- 「是否為外部依賴關係定義了重試/超時需求？[覆蓋率，Gap]」
- 「版本控制策略是否在需求中記錄？[Gap]」

**效能需求品質**：`performance.md`

項目範例：

- 「效能需求是否用具體指標量化？[清晰度]」
- 「是否為所有關鍵使用者旅程定義了效能目標？[覆蓋率]」
- 「是否指定了不同負載條件下的效能需求？[完整性]」
- 「效能需求是否可以客觀衡量？[可衡量性]」
- 「是否為高負載情境定義了降級需求？[邊緣案例，Gap]」

**安全性需求品質**：`security.md`

項目範例：

- 「是否為所有受保護資源指定了身份驗證需求？[覆蓋率]」
- 「是否為敏感資訊定義了資料保護需求？[完整性]」
- 「威脅模型是否已記錄，並且需求與之對齊？[可追溯性]」
- 「安全性需求是否與合規義務一致？[一致性]」
- 「是否定義了安全性故障/洩露回應需求？[Gap，例外流程]」

## 反例：不該做什麼

**❌ 錯誤——這些測試實作，而不是需求：**

```markdown
- [ ] CHK001 - 驗證登陸頁面顯示 3 個劇集卡片 [規格 §FR-001]
- [ ] CHK002 - 測試懸停狀態在桌面上是否正確工作 [規格 §FR-003]
- [ ] CHK003 - 確認標誌點擊導航到主頁 [規格 §FR-010]
- [ ] CHK004 - 檢查相關劇集部分顯示 3-5 個項目 [規格 §FR-005]
```

✅ **正確——這些測試需求品質：**

```markdown
- [ ] CHK001 - 是否明確指定了特色劇集的數量和佈局？[完整性，規格 §FR-001]
- [ ] CHK002 - 懸停狀態需求是否為所有互動元素一致定義？[一致性，規格 §FR-003]
- [ ] CHK003 - 所有可點擊品牌元素的導航需求是否清晰？[清晰度，規格 §FR-010]
- [ ] CHK004 - 是否記錄了相關劇集的選擇標準？[Gap，規格 §FR-005]
- [ ] CHK005 - 是否為非同步劇集資料定義了載入狀態需求？[Gap]
- [ ] CHK006 - 「視覺層次結構」需求是否可以客觀衡量？[可衡量性，規格 §FR-001]
```

**主要區別**：

- 錯誤：測試系統是否正常工作
- 正確：測試需求是否正確撰寫
- 錯誤：行為驗證
- 正確：需求品質驗證
- 錯誤：「它是否執行 X？」
- 正確：「X 是否明確指定？」
