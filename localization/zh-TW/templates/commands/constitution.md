---
description: 從互動式或提供的原則輸入建立或更新專案憲法，確保所有相關範本保持同步。
handoffs: 
  - label: Build Specification
    agent: speckit.specify
    prompt: Implement the feature specification based on the updated constitution. I want to build...
---

## 使用者輸入

```text
$ARGUMENTS
```

您**必須**在繼續之前考慮使用者輸入（如果非空）。

## 概述

您正在更新 `/memory/constitution.md` 中的專案憲法。此檔案是一個包含方括號中佔位符標記（例如 `[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`）的**範本**。您的任務是 (a) 收集/推導具體值，(b) 精確填寫範本，以及 (c) 將任何修訂傳播到相關產物。

遵循此執行流程：

1. 載入 `/memory/constitution.md` 中現有的憲法範本。
   - 識別所有形式為 `[ALL_CAPS_IDENTIFIER]` 的佔位符標記。
   **重要**：使用者可能需要比範本中使用的原則更少或更多的原則。如果指定了數字，請遵守該數字 - 遵循通用範本。您將相應地更新文件。

2. 收集/推導佔位符的值：
   - 如果使用者輸入（對話）提供了值，請使用它。
   - 否則從現有倉庫上下文（README、文件、如果嵌入了先前的憲法版本）推斷。
   - 對於治理日期：`RATIFICATION_DATE` 是原始採納日期（如果未知則詢問或標記 TODO），如果進行了更改，`LAST_AMENDED_DATE` 是今天，否則保留以前的。
   - `CONSTITUTION_VERSION` 必須根據語義版本控制規則遞增：
     - 主要：向後不相容的治理/原則刪除或重新定義。
     - 次要：新增原則/部分或實質性擴展指導。
     - 修補程式：澄清、措辭、錯字修正、非語義改進。
   - 如果版本升級類型不明確，請在最終確定前提出理由。

3. 草擬更新後的憲法內容：
   - 將每個佔位符替換為具體文字（不留下任何方括號標記，除非專案選擇尚未定義的有意保留的範本槽位——明確說明任何保留的原因）。
   - 保留標題層次結構，並且註釋一旦替換就可以刪除，除非它們仍然提供澄清指導。
   - 確保每個原則部分：簡潔的名稱行、捕捉不可協商規則的段落（或項目符號列表）、如果不明顯則明確說明理由。
   - 確保治理部分列出修訂程序、版本控制策略和合規性審查預期。

4. 一致性傳播檢查表（將先前的檢查表轉換為活動驗證）：
   - 讀取 `/templates/plan-template.md` 並確保任何「憲法檢查」或規則與更新後的原則保持一致。
   - 讀取 `/templates/spec-template.md` 以進行範圍/需求對齊——如果憲法新增/刪除了強制部分或約束，則進行更新。
   - 讀取 `/templates/tasks-template.md` 並確保任務分類反映了新的或已刪除的原則驅動任務類型（例如，可觀察性、版本控制、測試紀律）。
   - 讀取 `/templates/commands/*.md` 中的每個命令檔案（包括此檔案），以驗證在需要通用指導時沒有過時的參考（僅限 CLAUDE 等代理程式特定名稱）保留。
   - 讀取任何執行時指導文件（例如，`README.md`、`docs/quickstart.md` 或如果存在代理程式特定指導檔案）。更新對已更改原則的參考。

5. 產生同步影響報告（更新後作為 HTML 註釋預置在憲法檔案頂部）：
   - 版本更改：舊 → 新
   - 已修改原則列表（如果重命名，則為舊標題 → 新標題）
   - 已新增部分
   - 已刪除部分
   - 需要更新的範本（✅ 已更新 / ⚠ 待處理）以及檔案路徑
   - 如果有意推遲任何佔位符，則進行後續 TODO。

6. 最終輸出前的驗證：
   - 沒有剩餘的未解釋的方括號標記。
   - 版本行與報告匹配。
   - 日期為 ISO 格式 YYYY-MM-DD。
   - 原則具有聲明性、可測試性，並且沒有模糊語言（「應該」→ 在適當情況下替換為必須/應該的理由）。

7. 將完成的憲法寫回 `/memory/constitution.md`（覆蓋）。

8. 向使用者輸出最終摘要，包括：
   - 新版本和升級理由。
   - 任何標記為需要手動跟進的檔案。
   - 建議的提交訊息（例如，`docs: amend constitution to vX.Y.Z (principle additions + governance update)`）。

格式和樣式要求：

- 完全按照範本中的 Markdown 標題使用（不要降級/升級級別）。
- 包裹長理由行以保持可讀性（理想情況下 <100 個字元），但不要強制使用不自然的斷行。
- 各部分之間保留一個空行。
- 避免尾隨空格。

如果使用者提供了部分更新（例如，僅修訂一個原則），仍執行驗證和版本決策步驟。

如果缺少關鍵資訊（例如，批准日期確實未知），請插入 `TODO(<FIELD_NAME>): explanation` 並將其包含在同步影響報告的推遲項目下。

不要建立新範本；始終在現有的 `/memory/constitution.md` 檔案上操作。
